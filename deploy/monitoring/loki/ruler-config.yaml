ruler:
  # Enable the ruler API
  enable_api: true
  
  # Directory to store temporary rule files
  rule_path: /tmp/loki/rules-temp
  
  # How frequently to evaluate rules
  evaluation_interval: 1m
  
  # How frequently to poll for new rule files
  poll_interval: 10s
  
  # Alertmanager configuration
  alertmanager_url: http://alertmanager.monitoring.svc.cluster.local:9093
  
  # External labels for alerts
  external_labels:
    cluster: quantum-infra-zero
    environment: production
    team: sre
  
  # Alert relabeling
  alert_relabel_configs:
    - action: replace
      source_labels: [__meta_kubernetes_pod_node_name]
      target_label: node
    - action: replace
      source_labels: [__meta_kubernetes_namespace]
      target_label: namespace
    - action: replace
      source_labels: [__meta_kubernetes_pod_name]
      target_label: pod
    - action: replace
      source_labels: [__meta_kubernetes_pod_container_name]
      target_label: container
  
  # Alertmanager client config
  alertmanager_client:
    # Basic auth for Alertmanager
    basic_auth:
      username: ${ALERTMANAGER_USER}
      password: ${ALERTMANAGER_PASSWORD}
    
    # TLS configuration
    tls_config:
      insecure_skip_verify: false
    
    # Timeout for requests to Alertmanager
    timeout: 10s
  
  # Enable sharding for high availability
  enable_sharding: true
  sharding_strategy: shuffle_sharding
  shard_size: 2
  
  # Ring configuration for distributed mode
  ring:
    kvstore:
      store: memberlist
    replication_factor: 3
  
  # Remote write configuration
  remote_write:
    - url: http://loki-wal.monitoring.svc.cluster.local:3100/loki/api/v1/push
      remote_timeout: 10s
      write_relabel_configs:
        - source_labels: [__name__]
          regex: "ALERTS|ALERTS_FOR_STATE"
          action: keep
  
  # Storage configuration
  storage:
    type: local
    local:
      directory: /rules
  
  # Rule namespace and group configuration
  rule_namespace: default
  rule_path: /etc/loki/rules
  
  # Notification queue configuration
  notification_queue_capacity: 10000
  notification_timeout: 1m
  
  # External URL for alert links
  external_url: https://grafana.monitoring.example.com
  
  # Log level for the ruler
  log_level: info
  
  # Metrics
  metrics:
    enable_alertmanager_v2: true
    enable_api: true
    
  # Alert relabel configs for all alerts
  alert_relabel_configs:
    - source_labels: [severity]
      target_label: alert_severity
    - source_labels: [alertname]
      target_label: alert_name
    - source_labels: [namespace]
      target_label: kubernetes_namespace
    - source_labels: [pod]
      target_label: kubernetes_pod_name
    - source_labels: [container]
      target_label: kubernetes_container_name
    
  # Alertmanager notification queue configuration
  notification_queue_config:
    capacity: 10000
    timeout: 10s
    for_grace_period: 10m
    for_outage_tolerance: 1h
    resend_delay: 1m
